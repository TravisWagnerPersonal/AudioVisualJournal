<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- Modern PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Audio Journal">
    <meta name="theme-color" content="#6366f1">
    <meta name="msapplication-TileColor" content="#6366f1">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
    
    <!-- Startup Images -->
    <link rel="apple-touch-startup-image" href="startup.png">
    
    <title>Audio-Photo Journal</title>
    <link rel="stylesheet" href="styles.css?v=2.0">
    <link rel="stylesheet" href="mobile.css?v=2.0">
    <link rel="stylesheet" href="photo-viewer.css?v=2.0">
    
    <!-- Force deployment refresh - Modern Design v2.0 -->
</head>
<body>
    
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading">
        <div class="spinner"></div>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container fade-in" style="display: none;">
        
        <!-- App Header -->
        <header class="app-header">
            <h1 class="app-title">Audio Journal</h1>
            <p class="app-subtitle">Capture life's moments with photos, voice, and words</p>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav">
                <div class="nav-item">
                    <button class="nav-btn active" data-view="timeline">
                        üìù Journal
                    </button>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" data-view="create">
                        ‚ûï New Entry
                    </button>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" data-view="search">
                        üîç Search
                    </button>
                </div>
                <div class="nav-item">
                    <button class="nav-btn" data-view="settings">
                        ‚öôÔ∏è Settings
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Timeline View (Default) -->
            <section id="timeline-view" class="view active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">üìñ</div>
                            Your Journal
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-secondary" data-view-mode="list">List</button>
                            <button class="btn btn-primary" data-view-mode="grid">Grid</button>
                        </div>
                    </div>
                    
                    <div id="entries-container" class="entries-grid">
                        <!-- Journal entries will be dynamically inserted here -->
                    </div>
                    
                    <div id="empty-state" class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">Start Your Journey</div>
                        <p>Capture your thoughts, moments, and memories with audio and photos.</p>
                        <button class="btn btn-primary btn-lg" onclick="showCreateEntry()">Create Your First Entry</button>
                    </div>
                </div>
            </section>

            <!-- Create/Edit Entry View -->
            <section id="create-view" class="view">
                <form class="journal-form">
                    
                    <!-- Entry Title -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">‚úçÔ∏è</div>
                            What's on your mind?
                        </div>
                        <div class="form-group">
                            <input type="text" id="entry-title" class="form-input" placeholder="Give your entry a title..." maxlength="100">
                        </div>
                        <div class="form-group">
                            <textarea id="entry-content" class="form-textarea" placeholder="Write about your day, thoughts, or anything that comes to mind..." rows="6"></textarea>
                        </div>
                    </div>
                    
                    <!-- Photos Section -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">üì∑</div>
                            Photos
                        </div>
                        <div class="media-grid">
                            <div class="media-control" id="take-photo">
                                <div class="media-control-icon">üì∏</div>
                                <div class="media-control-text">Take Photo</div>
                            </div>
                            <div class="media-control" id="select-photo">
                                <div class="media-control-icon">üñºÔ∏è</div>
                                <div class="media-control-text">Choose Photo</div>
                            </div>
                        </div>
                        <div id="photo-preview" class="photo-preview mt-4"></div>
                    </div>
                    
                    <!-- Audio Section -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">üé§</div>
                            Audio Recording with Live Transcription
                        </div>
                        <div class="audio-recorder">
                            <button id="record-btn" class="record-button" type="button">
                                üé§
                            </button>
                            <div id="recording-timer" class="recording-timer hidden">00:00</div>
                            <p>Tap to record your voice</p>
                            <div class="speech-status" id="speech-status">
                                <div class="speech-indicator"></div>
                                <span>Ready to record with live transcription</span>
                            </div>
                        </div>
                        <div id="audio-preview" class="audio-preview"></div>
                    </div>
                    
                    <!-- Mood & Tags -->
                    <div class="section">
                        <div class="mood-selector">
                            <div class="mood-title">How are you feeling?</div>
                            <div class="mood-options">
                                <button type="button" class="mood-option" data-mood="happy">üòä</button>
                                <button type="button" class="mood-option" data-mood="sad">üò¢</button>
                                <button type="button" class="mood-option" data-mood="excited">ü§©</button>
                                <button type="button" class="mood-option" data-mood="calm">üòå</button>
                                <button type="button" class="mood-option" data-mood="anxious">üò∞</button>
                                <button type="button" class="mood-option" data-mood="grateful">üôè</button>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="btn-group">
                        <button type="button" id="cancel-create" class="btn btn-secondary">Cancel</button>
                        <button type="button" id="ai-assist-btn" class="btn btn-accent">ü§ñ AI Assist</button>
                        <button type="submit" id="save-entry" class="btn btn-success btn-lg">Save Entry</button>
                    </div>
                </form>

                <!-- AI Assistant Panel -->
                <div id="ai-panel" class="card mt-6 hidden">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">ü§ñ</div>
                            AI Assistant
                        </div>
                        <button id="ai-panel-close" class="btn btn-secondary">√ó</button>
                    </div>
                    <div class="ai-status" id="ai-status">Ready to help you create amazing journal entries!</div>
                    <div class="btn-group">
                        <button id="ai-analyze-photo" class="btn btn-secondary">üì∑ Analyze Photos</button>
                        <button id="ai-transcribe-audio" class="btn btn-secondary">üé§ Transcribe Audio</button>
                        <button id="ai-generate-entry" class="btn btn-primary">‚ú® Generate Entry</button>
                    </div>
                    <div id="ai-results" class="mt-4 hidden"></div>
                </div>
            </section>

            <!-- Search View -->
            <section id="search-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">üîç</div>
                            Search Your Journal
                        </div>
                    </div>
                    <div class="form-group">
                        <input type="text" id="search-input" class="form-input" placeholder="Search entries by title, content, or tags..." autocomplete="off">
                    </div>
                    <div id="search-results" class="entries-grid mt-6">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîç</div>
                            <div class="empty-state-text">Start typing to search</div>
                            <p>Find entries by keywords, dates, moods, or tags.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="settings-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">‚öôÔ∏è</div>
                            Settings
                        </div>
                    </div>
                    
                    <!-- AI Features -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">ü§ñ</div>
                            AI Features
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="auto-generate-toggle"> Auto-generate entries with AI
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="speech-recognition-toggle"> Enable speech recognition
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="auto-tag-toggle"> Auto-tag with AI
                            </label>
                        </div>
                    </div>

                    <!-- Journal Preferences -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">üìù</div>
                            Journal Preferences
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="auto-save-toggle" checked> Auto-save drafts
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="show-dates-toggle" checked> Show date stamps
                            </label>
                        </div>
                    </div>

                    <!-- Location & Weather -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">üìç</div>
                            Location & Weather
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="location-enabled-toggle"> Enable location services
                            </label>
                            <small>Capture location data for journal entries</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Weather API Key (OpenWeatherMap):</label>
                            <input type="password" id="weather-api-key" class="form-input" placeholder="Enter your weather API key">
                            <small>Get a free API key at <a href="https://openweathermap.org/api" target="_blank">openweathermap.org</a></small>
                        </div>
                        <div class="btn-group">
                            <button id="location-settings-btn" class="btn btn-secondary">üìç Location Settings</button>
                            <button id="test-location-btn" class="btn btn-secondary">üß™ Test Location</button>
                        </div>
                    </div>

                    <!-- Data Management -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">üíæ</div>
                            Data Management
                        </div>
                        <div class="btn-group">
                            <button id="export-data-btn" class="btn btn-secondary">üì§ Export Data</button>
                            <button id="import-data-btn" class="btn btn-secondary">üì• Import Data</button>
                        </div>
                        <div class="btn-group mt-4">
                            <button id="clear-entries-btn" class="btn btn-accent">üóëÔ∏è Delete All Entries</button>
                            <button id="reset-app-btn" class="btn btn-accent">üîÑ Reset App</button>
                        </div>
                    </div>

                    <!-- Storage Info -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">üìä</div>
                            Storage Usage
                        </div>
                        <div id="storage-info" class="text-center">
                            <p id="storage-status">Calculating storage usage...</p>
                        </div>
                    </div>

                    <!-- About -->
                    <div class="section">
                        <div class="section-title">
                            <div class="section-icon">‚ÑπÔ∏è</div>
                            About
                        </div>
                        <div class="text-center">
                            <h3>Audio-Photo Journal</h3>
                            <p>Version 2.0.0 with AI Integration</p>
                            <p class="mt-2">A beautiful, private journaling app that captures your thoughts, photos, and voice recordings.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Entry Detail View -->
            <section id="detail-view" class="view">
                <div class="card">
                    <div class="card-header">
                        <button id="back-to-timeline" class="btn btn-secondary">‚Üê Back</button>
                        <button id="edit-entry" class="btn btn-primary">Edit</button>
                    </div>
                    <div id="detail-content" class="detail-content">
                        <!-- Entry details will be dynamically loaded here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="photo-input" accept="image/*" capture="environment" style="display: none;">
    <input type="file" id="file-input" accept="image/*" style="display: none;">
    
    <!-- Photo Viewer Modal -->
    <div id="photo-viewer" class="photo-viewer-modal hidden">
        <div class="photo-viewer-content">
            <button class="photo-viewer-close">&times;</button>
            <img id="photo-viewer-img" alt="Full size photo">
            <div class="photo-viewer-controls">
                <button class="photo-viewer-btn" id="photo-viewer-prev">‚Äπ</button>
                <button class="photo-viewer-btn" id="photo-viewer-next">‚Ä∫</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="debug.js"></script>
    <script src="location-services.js?v=2.1"></script>
    <script src="app.js?v=2.1"></script>
    <script src="journal.js?v=2.1"></script>
    <script src="camera.js?v=2.1"></script>
    <script src="audio.js?v=2.1"></script>
    <script src="ai-services-improved.js?v=2.1"></script>
    <script src="photo-manager.js?v=2.1"></script>
    <script src="settings.js?v=2.1"></script>
    
    <!-- Service Worker Registration -->
    <script>
        console.log('üöÄ Audio Journal Debug v2.0 - Starting...');
        
        // Debug: Check if key elements exist
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìã DOM Content Loaded - Checking elements...');
            
            const checks = [
                'loading-screen',
                'app',
                'timeline-view',
                'entries-container',
                'empty-state'
            ];
            
            checks.forEach(id => {
                const element = document.getElementById(id);
                console.log(`Element #${id}:`, element ? '‚úÖ Found' : '‚ùå Missing');
            });
            
            console.log('Navigation buttons:', document.querySelectorAll('.nav-btn').length);
            console.log('App initialization should begin now...');
        });
        
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html> 