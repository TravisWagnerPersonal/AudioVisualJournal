name: Fixed Static Deploy

on:
  push:
    branches: [ main ]
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: üîç Environment Diagnostics
        run: |
          echo "üîç DEPLOYMENT DIAGNOSTICS:"
          echo "Runner: $(uname -a)"
          echo "Working Directory: $(pwd)"
          echo "Available Actions: $(ls -la)"
          echo "Git Status: $(git --version)"
          
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: üìã Validate Repository Contents
        run: |
          echo "üìã REPOSITORY VALIDATION:"
          echo "Files in root: $(ls -la)"
          echo "Icons directory: $(ls -la icons/ 2>/dev/null || echo 'No icons directory')"
          echo "Critical files check:"
          [ -f "index.html" ] && echo "‚úÖ index.html found" || echo "‚ùå index.html missing"
          [ -f "app.js" ] && echo "‚úÖ app.js found" || echo "‚ùå app.js missing"
        
      - name: Create docs directory
        run: |
          echo "üìÅ Creating docs directory for GitHub Pages..."
          mkdir -p docs
          
          # Copy all files to docs with validation
          echo "Copying files..."
          cp index.html docs/ && echo "‚úÖ index.html copied"
          cp *.js docs/ 2>/dev/null && echo "‚úÖ JS files copied" || echo "‚ö†Ô∏è No JS files"
          cp *.css docs/ 2>/dev/null && echo "‚úÖ CSS files copied" || echo "‚ö†Ô∏è No CSS files" 
          cp *.json docs/ 2>/dev/null && echo "‚úÖ JSON files copied" || echo "‚ö†Ô∏è No JSON files"
          cp *.png docs/ 2>/dev/null && echo "‚úÖ PNG files copied" || echo "‚ö†Ô∏è No PNG files"
          
          # Copy icons if they exist
          if [ -d "icons" ]; then
            cp -r icons docs/ && echo "‚úÖ Icons directory copied"
          else
            echo "‚ö†Ô∏è No icons directory found"
          fi
          
          # Create .nojekyll to bypass Jekyll processing
          touch docs/.nojekyll && echo "‚úÖ .nojekyll created"
          
          echo "üìä DEPLOYMENT PACKAGE CONTENTS:"
          find docs -type f | head -20
          echo "Total files: $(find docs -type f | wc -l)"
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
          force_orphan: true 